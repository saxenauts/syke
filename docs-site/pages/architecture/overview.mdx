import { FileTree, Cards } from 'nextra/components'

# Architecture Overview

~6,500 source lines of Python. Four layers.

```mermaid
graph LR
    subgraph Ingestion
        A1[Claude Code Adapter]
        A2[ChatGPT Adapter]
        A3[GitHub Adapter]
        A4[Gmail Adapter]
    end

    subgraph Storage
        DB[(SQLite + WAL + FTS5)]
    end

    subgraph Memory["Memory Synthesis"]
        AS[Agent SDK]
        MT[15 Memory Tools]
        MX[Memex]
        AS --> MT --> MX
    end

    subgraph Distribution
        MCP[MCP Server]
        FMT[Formatters]
        INJ[File Injection]
    end

    A1 & A2 & A3 & A4 --> DB
    DB --> AS
    MX --> FMT & MCP & INJ
```

## Deep Dives

<Cards>
  <Cards.Card title="Memory" href="/architecture/memory" />
  <Cards.Card title="Ingestion" href="/architecture/ingestion" />
  <Cards.Card title="Distribution" href="/architecture/distribution" />
</Cards>

## Package Structure

<FileTree>
  <FileTree.Folder name="syke" defaultOpen>
    <FileTree.File name="cli.py" />
    <FileTree.File name="sync.py" />
    <FileTree.File name="config.py" />
    <FileTree.File name="db.py" />
    <FileTree.File name="models.py" />
    <FileTree.File name="metrics.py" />
    <FileTree.Folder name="ingestion" defaultOpen>
      <FileTree.File name="base.py" />
      <FileTree.File name="claude_code.py" />
      <FileTree.File name="chatgpt.py" />
      <FileTree.File name="github_.py" />
      <FileTree.File name="gmail.py" />
      <FileTree.File name="gateway.py" />
    </FileTree.Folder>
    <FileTree.Folder name="memory" defaultOpen>
      <FileTree.File name="tools.py" />
      <FileTree.File name="synthesis.py" />
      <FileTree.File name="memex.py" />
    </FileTree.Folder>
    <FileTree.Folder name="distribution" defaultOpen>
      <FileTree.File name="ask_agent.py" />
      <FileTree.File name="formatters.py" />
      <FileTree.File name="inject.py" />
      <FileTree.File name="mcp_server.py" />
    </FileTree.Folder>
    <FileTree.Folder name="daemon">
      <FileTree.File name="daemon.py" />
      <FileTree.File name="metrics.py" />
    </FileTree.Folder>
    <FileTree.Folder name="llm">
      <FileTree.File name="client.py" />
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

## Key Design Decisions

**The LLM does semantic understanding, not the database.** Syke doesn't need a vector DB. SQLite with WAL mode gives concurrent reads, ACID transactions, zero infrastructure. FTS5/BM25 handles keyword retrieval — semantic understanding happens in the synthesis agent's reasoning.

**Sessions, not messages.** A Claude Code session about "refactoring auth" contains 50+ messages but represents one coherent activity. Per-message would bloat the timeline 50x and force the agent to spend tokens reconstructing context.

**Privacy by design, not afterthought.** The content filter runs *before* events enter SQLite. Credentials and private messages never touch the database. Content that never enters the timeline can never be sent to an LLM.

**Evidence ≠ inference.** Raw events (what happened) are immutable. Memories (what it means) are mutable and agent-written. The synthesis agent reads events and writes memories — the two layers never mix.

**Four formats for four consumers.** JSON for programs, Markdown for humans, CLAUDE.md for Claude Code projects, USER.md for portable identity. Same synthesized identity, different shapes.
